<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Holmes | FastActivator API Reference </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Holmes | FastActivator API Reference ">
      
      
      <link rel="icon" href="favicon.ico">
      <link rel="stylesheet" href="public/docfx.min.css">
      <link rel="stylesheet" href="public/main.css">
      <meta name="docfx:navrel" content="toc.html">
      <meta name="docfx:tocrel" content="toc.html">
      
      <meta name="docfx:rel" content="">
      
      
      <meta name="docfx:docurl" content="https://github.com/JaCraig/Holmes/blob/master/docfx_project/index.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="index.html">
            <img id="logo" class="svg" src="images/icon.png" alt="FastActivator">
            FastActivator
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">

      <div class="content">
        <div class="actionbar">

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="holmes">Holmes</h1>

<p><a href="https://ci.appveyor.com/project/JaCraig/holmes"><img src="https://ci.appveyor.com/api/projects/status/w95i5th94ayc3f6q?svg=true" alt="Build status"></a></p>
<p>Holmes is a database analysis library. It scans a database and returns suggestions for improvement. Supports .Net Core as well as full .Net</p>
<h2 id="setting-up-the-library">Setting Up the Library</h2>
<p>In order to use Holmes, you need to start by wiring it up on your ServiceCollection. However this takes just one extension method call:</p>
<pre><code>serviceCollection.AddCanisterModules();
				
</code></pre>
<p>When this is done, Holmes is ready to use.</p>
<h2 id="basic-usage">Basic Usage</h2>
<p>The main class of interest is the Sherlock class:</p>
<pre><code>var Results = Sherlock.Analyze(new Connection(...));
</code></pre>
<p>The Sherlock class contains one function which is Analyze. This function takes a Connection object defining where the library should be pointed. It will then, based on the provider specified in the connection object, run any analysis classes that it has and returns a list of Finding objects. The Finding class looks like this:</p>
<pre><code>public class Finding
{
	public string Fix { get; }
	public IDictionary&lt;string, object&gt; Metrics { get; }
	public string Text { get; }
}
</code></pre>
<p>The Text property contains the explination of what was found, the Metrics property contains the data that was returned by the analysis object, and the Fix property contains the SQL command that can be used to remedy the issue. Note that not all analysis classes will contain a suggested fix. This is optional where as the other two properties will always contain some information.</p>
<h2 id="adding-your-own-analyzer">Adding Your Own Analyzer</h2>
<p>The system a couple of built in analyzers:</p>
<ul>
<li>SQL Server
<ul>
<li>Recent expensive queries</li>
<li>Missing indexes</li>
<li>Overlapping indexes</li>
<li>Unused indexes</li>
</ul>
</li>
</ul>
<p>However you can easily add your own analyzer by simply creating a class that inherits from IAnalyzer.  The system will then pick it up automatically and run it as well. For simple analyzers there is also an AnalyzerBaseClass that will simplify the process of setting up your analyzer. The IAnalyzer interface itself is rather simple though:</p>
<pre><code>public interface IAnalyzer
{
    /// &lt;summary&gt;
    /// Gets the factory the analyzer supports.
    /// &lt;/summary&gt;
    /// &lt;value&gt;Gets the factory the analyzer supports.&lt;/value&gt;
    DbProviderFactory SupportedFactory { get; }

    /// &lt;summary&gt;
    /// Adds the query the analyzer needs to the batch.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;batch&quot;&gt;The batch.&lt;/param&gt;
    /// &lt;returns&gt;This.&lt;/returns&gt;
    IAnalyzer AddQuery(SQLHelper.SQLHelper batch);

    /// &lt;summary&gt;
    /// Analyzes the specified connection's source database.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;results&quot;&gt;The results of the analysis.&lt;/param&gt;
    /// &lt;returns&gt;The list of suggestions for the database.&lt;/returns&gt;
    IEnumerable&lt;Finding&gt; Analyze(IEnumerable&lt;dynamic&gt; results);
}
</code></pre>
<p>The SupportedFactory property is the DbProviderFactory that this analyzer should be run against. All analyzer queries are batched together by the system and run at once. As such there is an AddQuery function. With this function the system passes you the SQLHelper object it is using to batch the various queries. The one method on that you will probably use is AddQuery. The only other method is Analyze. This method recieves the results of the query as a list of dynamic objects. The names of each property is the same as the result set of the query you specified previously. In turn you should return a list of Finding objects.</p>
<h2 id="installation">Installation</h2>
<p>The library is available via Nuget with the package name &quot;Holmes&quot;. To install it run the following command in the Package Manager Console:</p>
<pre><code>Install-Package Holmes
</code></pre>
<h2 id="build-process">Build Process</h2>
<p>In order to build the library you will require the following:</p>
<ol>
<li>Visual Studio 2022</li>
</ol>
<p>Other than that, just clone the project and you should be able to load the solution and build without too much effort.</p>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/JaCraig/Holmes/blob/master/docfx_project/index.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <strong><a href='https://github.com/JaCraig/FastActivator'>Open in Github</a></strong>
        </div>
      </div>
    </footer>
  </body>
</html>
